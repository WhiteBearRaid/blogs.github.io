<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>ladder</title>
    <link href="/2024/10/19/ladder/"/>
    <url>/2024/10/19/ladder/</url>
    
    <content type="html"><![CDATA[<p>思维直觉对于事情的判断首先是通过直觉的，直觉的构成包括个人认知，思维各种因素在内，当做一件事件的时候，个人直觉的判断和客观的事实结果有出入，这个时候就需要分析个人直觉判断和客观事实的出入体现在哪里，是个人直觉里的哪部分出现了认知错误或者说不足，这就是反馈，通过反馈去校正个人直觉，从而去完善个人直觉，我们把他当做自适应控制器，通过反馈也就是直觉和客观事实的误差来不断的修正控制器，就可以实现控制器对不同事情的精准控制（我们可以理解为解决事情）。学习的过程就是一个不断修正、补充、完善系统的过程，如果个人直觉对事物的判断和处理有偏差，要及时去查明原因，从而反馈自身来调整，才能达到学习的目的。</p><p>拒绝工程师思维（劳动命思维），所有事情都硬扣细节，要有大局意识，看到该看的。不要优柔寡断，该落地就落地，错过了就没了。 <ahref="https://www.bilibili.com/video/BV1SV4y1U7h5/?spm_id_from=333.337.search-card.all.click&amp;vd_source=f1fc43fc2fc199d3fd1af8b33f4f5991">拒绝工程师思维和优柔寡断</a>。</p><p>学习：</p><ol type="1"><li><p>取势=学习目的+学习本质</p><p>1.1 学习的目的（没有目的不叫学习）</p><ol type="a"><li><p>解决什么？要学什么？学到什么程度？</p></li><li><p>不带着目的学习，不叫学习</p></li><li><p>明确目的，抓大放小</p></li></ol><p>1.2 学习内容的本质规律（学习要抓本质，花 最少的时间做最正确的事）</p><ol type="a"><li><p>抓本质，是取势的捷径</p></li><li><p>不会抓本质，会事倍功半</p></li></ol><p>1.3 取势实操方法：四赢法</p><ol type="a"><li><p>搞懂本质</p></li><li><p>提取关键（关键术语，关键步骤，关键过程）</p></li><li><p>针对性去看</p></li><li><p>实操积累套路经验</p></li></ol></li><li><p>明道=记忆+理解+运用</p><ol type="a"><li><p>记忆就是重复频率，分散记忆，多次重复，交替记忆</p></li><li><p>理解前需要有记忆，学会将抽象概念与实际联系，抽象概念与抽象概念联系</p></li><li><p>运用就是先模仿再独立实现</p></li></ol></li><li><p>优术篇</p><ol type="a"><li><p>复盘迭代</p></li><li><p>发现问题，找到本质，给出解决办法（针对问题重点突破），分类汇总经验</p></li></ol></li></ol>]]></content>
    
    
    <categories>
      
      <category>意识流</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ladder</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>磁链观测器</title>
    <link href="/2024/10/19/%E7%A3%81%E9%93%BE%E8%A7%82%E6%B5%8B%E5%99%A8/"/>
    <url>/2024/10/19/%E7%A3%81%E9%93%BE%E8%A7%82%E6%B5%8B%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<p>非线性磁链观测器的状态变量为磁链值，观测的磁链值收敛于电机实际磁链值，观测器收敛。SPM的 <span class="math inline">\(\alpha\beta\)</span> 轴电压方程：</p><p>（1） <span class="math inline">\(\begin{bmatrix}  u_\alpha\\  u_\beta  \end{bmatrix} = \begin{bmatrix} R+pL_d &amp;  0\\ 0&amp;R+pL_q \end{bmatrix}\begin{bmatrix} i_\alpha  \\ i_\beta\end{bmatrix}+ [w\psi_m]\begin{bmatrix} -sin\theta \\cos\theta\end{bmatrix}\)</span></p><p>将公式（1）进行变换得到：</p><p>（2） <span class="math inline">\(L\begin{bmatrix} \dot{i_\alpha} \\\dot{i_\beta}  \end{bmatrix}=-R_s\begin{bmatrix} i_\alpha\\i_\beta\end{bmatrix}+w\psi_m\begin{bmatrix}sin\theta\\-cos\theta  \end{bmatrix}+\begin{bmatrix} u_\alpha \\u_\beta\end{bmatrix}\)</span></p><p>状态空间方程：</p><p><span class="math inline">\(\left\{\begin{matrix}  \dot{x}=Ax+Bu\\  y=Cx \end{matrix}\right.\)</span></p><p>定义状态变量X：</p><p>（3） <span class="math inline">\(\begin{bmatrix}\dot{x1}\\\dot{x2}\end{bmatrix}=L\begin{bmatrix}\dot{i_\alpha}\\\dot{i_\beta}\end{bmatrix}-w\psi_m\begin{bmatrix} sin\theta\\-cos\theta\end{bmatrix}=\begin{bmatrix}y1\\y2\end{bmatrix}\)</span></p><p>（4） <spanclass="math inline">\(\begin{bmatrix}y1\\y2\end{bmatrix}=-R_s\begin{bmatrix}i_\alpha\\i_\beta\end{bmatrix}+\begin{bmatrix}u_\alpha\\u_\beta\end{bmatrix}\)</span></p><p>对式（3）两边进行积分可得：</p><p>（5） <spanclass="math inline">\(\begin{bmatrix}x1\\x2\end{bmatrix}=L\begin{bmatrix}i_\alpha\\i_\beta\end{bmatrix}+\psi_m\begin{bmatrix}cos\theta\\sin\theta\end{bmatrix}\)</span></p><p>因为w 是，所以积分后消去了w项。 定义空间向量eta(x):</p><p>（6） <spanclass="math inline">\(eta(x)=\begin{bmatrix}eta(x1)\\eta(x2)\end{bmatrix}=x-L\begin{bmatrix}i_\alpha\\i_\beta\end{bmatrix}=\psi_m\begin{bmatrix}cos\theta\\sin\theta\end{bmatrix}\)</span></p><p>观测器模型：</p><p><spanclass="math inline">\(\left\{\begin{matrix}  \dot{\hat{x}}=A\hat{x}+Bu+K(y-\hat{y})\\\hat{y}=C\hat{x} \end{matrix}\right.\)</span></p><p>非线性磁链观测器模型：</p><p>（7） <span class="math inline">\(\begin{bmatrix}\dot{\hat{x1}}\\\dot{\hat{x2}} \end{bmatrix}=\begin{bmatrix}y1 \\y2\end{bmatrix}+\frac{\gamma}{2}\begin{bmatrix}eta(x1)\\eta(x2)\end{bmatrix}\{ \psi_m^2-\left \|  eta(x)\right \|^2\}\)</span></p><p>当观测器收敛时有：</p><p><span class="math inline">\(\psi_m^2=\left \|  eta(x)\right \|^2\)</span></p><p>对式（7）进行离散化：</p><p><span class="math inline">\(\begin{bmatrix} \hat{x1(k)}\\\hat{x2(k)}\end{bmatrix}=T_s \left [ \begin{bmatrix}y1_{(k-1)}\\y2_{(k-1)}\end{bmatrix}+\frac{\gamma}{2}\begin{bmatrix}etax1_{(k-1)}\\etax2_{(k-1)}\end{bmatrix}\{   \psi_m^2-\left\|  eta(x)\right \| ^2\  \}  \right ] +\begin{bmatrix} \hat{x1_{(k-1)}}\\ \hat{x2_{(x-1)}}\end{bmatrix}\)</span></p><p>由此可得包含观测角度的sin、cos值：</p><p><spanclass="math inline">\(\begin{bmatrix}cos{\hat{\theta}}\\sin{\hat{\theta}}\end{bmatrix}=\frac{1}{\psi_m}\left(\begin{bmatrix} \hat{x1_(k)} \\ \hat{x2_{(k)}}\end{bmatrix}-L\begin{bmatrix} i_\alpha \\ i_\beta \end{bmatrix} \right)\)</span></p><p>磁链观测器锁相环输入： <img src="/images/pll_input.png" />因为电机反电动势滞后于转子磁链90°，所以通过反电动势计算得出的相位需要补偿90°。</p>]]></content>
    
    
    <categories>
      
      <category>观测器</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nolinear flux observer</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>转子磁链和反电动势的相位关系</title>
    <link href="/2024/10/19/%E8%BD%AC%E5%AD%90%E7%A3%81%E9%93%BE%E5%92%8C%E5%8F%8D%E7%94%B5%E5%8A%A8%E5%8A%BF%E7%9A%84%E7%9B%B8%E4%BD%8D%E5%85%B3%E7%B3%BB/"/>
    <url>/2024/10/19/%E8%BD%AC%E5%AD%90%E7%A3%81%E9%93%BE%E5%92%8C%E5%8F%8D%E7%94%B5%E5%8A%A8%E5%8A%BF%E7%9A%84%E7%9B%B8%E4%BD%8D%E5%85%B3%E7%B3%BB/</url>
    
    <content type="html"><![CDATA[<p>dq轴定子电压方程如下：</p><p><span class="math inline">\(\left\{\begin{matrix}  u_d =Ri_d+\frac{d}{dt}\psi_d -w_e\psi_q\\ u_q=Ri_q+\frac{d}{dt}\psi_q+w_e\psi_d \end{matrix} \right.\)</span></p><p>定子磁链方程如下：</p><p><span class="math inline">\(\left\{\begin{matrix}  \psi_d = L_di_d +\psi_f\\ \psi_q = L_qi_q \end{matrix}\right.\)</span></p><p>合并定子电压方程和定子磁链方程可得：</p><p><span class="math inline">\(\left\{\begin{matrix}  u_d =Ri_d+L_d\frac{d}{dt}i_d -w_eL_qi_q \\ u_q=Ri_q+L_q\frac{d}{dt}i_q+w_e(L_di_d+\psi_f) \end{matrix} \right.\)</span></p><p>转子磁链投影到定子alpha轴上，可得：</p><p><span class="math inline">\(\psi_{\alpha} = \psi_fcos\theta_e\)</span></p><p>假设电机的电角速度是w_e，初始相位为0，则磁链可以表示为：</p><p><spanclass="math inline">\(\psi_{\alpha}=\psi_fcos(w_et)\)</span></p><p>根据最基本的法拉第电磁感应定律，d轴上的磁链，切割定子绕组，会产生感应电动势，可以求得该磁链切割定子绕组产生的感应电动势为：</p><p><span class="math inline">\(e =\frac{d\psi_{\alpha}}{dt}=\frac{d(\psi_fcos\theta_e)}{dt}=\psi_f\frac{d(cos(w_et))}{dt}=-w_e\psi_fsin(w_et)=w_e\psi_fcos(\theta_e+\frac{\pi}{2})\)</span></p><p>由此可知，相对于磁链的当前相位或者说角度而言，磁链切割绕组所产生的反电动势的相位超前磁链90°。因此d轴磁链切割定子绕组产生的反电动势位于q轴位置。在使用反电动势估算得出转子角度信息时，要减去90°的超前相位。</p>]]></content>
    
    
    <categories>
      
      <category>电机参数关系</category>
      
    </categories>
    
    
    <tags>
      
      <tag>磁链</tag>
      
      <tag>反电动势</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2024/10/19/hello-world/"/>
    <url>/2024/10/19/hello-world/</url>
    
    <content type="html"><![CDATA[<p>https://whitebear.zeabur.app</p><h1 id="fluid使用教程">fluid使用教程</h1><p>https://github.com/fluid-dev/hexo-theme-fluid</p><h1 id="注意">注意</h1><h1 id="配置fluid可按照fluid-yml里的链接来做">配置fluid可按照fluidyml里的链接来做</h1><h1id="支持latex需要安装pandoc独立软件">支持latex需要安装pandoc（独立软件）</h1><h1id="在初始化hexo时一定要以管理员方式来操作用npm来实现避免错误">在初始化hexo时，一定要以管理员方式来操作，用npm来实现，避免错误</h1><h1 id="部署时要开梯子才能访问github">部署时要开梯子才能访问github</h1><p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your veryfirst post. Check <a href="https://hexo.io/docs/">documentation</a> formore info. If you get any problems when using Hexo, you can find theanswer in <ahref="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> oryou can ask me on <ahref="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="quick-start">Quick Start</h2><h3 id="create-a-new-post">Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <ahref="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="run-server">Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="generate-static-files">Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <ahref="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="deploy-to-remote-sites">Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <ahref="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>磁链、转矩系数Kt、反电势系数Ke的关系</title>
    <link href="/2024/10/18/%E7%A3%81%E9%93%BE%E3%80%81%E8%BD%AC%E7%9F%A9%E7%B3%BB%E6%95%B0Kt%E3%80%81%E5%8F%8D%E7%94%B5%E5%8A%BF%E7%B3%BB%E6%95%B0Ke%E7%9A%84%E5%85%B3%E7%B3%BB/"/>
    <url>/2024/10/18/%E7%A3%81%E9%93%BE%E3%80%81%E8%BD%AC%E7%9F%A9%E7%B3%BB%E6%95%B0Kt%E3%80%81%E5%8F%8D%E7%94%B5%E5%8A%BF%E7%B3%BB%E6%95%B0Ke%E7%9A%84%E5%85%B3%E7%B3%BB/</url>
    
    <content type="html"><![CDATA[<p>磁链<span class="math inline">\(\psi\)</span> =空载反电动势幅值/电角频率（rad/s）</p><p><span class="math inline">\(\psi = \frac{E_{an-peak}}{w_e} =\frac{30*E_{an-peak}}{Poles * \pi * n}\)</span></p><p>其中：</p><p><spanclass="math inline">\(E_{an-peak}\)</span>：相反电动势幅值（峰值），单位 V</p><p><span class="math inline">\(w_e\)</span>：电角频率 ，单位 rad/s</p><p><span class="math inline">\(\psi\)</span>：电机磁链 ，单位 wb</p><p>相反电动势峰值和线反电动势峰值的关系：</p><p><span class="math inline">\(E_{an-peak} = \frac{E_{ab-peak}}{\sqrt{3}}\)</span></p><p>线反电动势峰值和线反电动势有效值的关系：</p><p><span class="math inline">\(E_{ab-peak}=E_{ab-rms}*\sqrt{2}\)</span></p><p><span class="math inline">\(w_e = Poles *2*\pi*\frac{n}{60}\)</span></p><p>其中：</p><p><span class="math inline">\(E_{ab-peak}\)</span>：线反电动势峰值，单位 V</p><p>n：电机机械转速 ，单位 rpm/min</p><p>磁链<spanclass="math inline">\(\psi\)</span>和线反电动势峰值的关系：</p><p><span class="math inline">\(\psi = \frac{30*E_{ab-peak} }{\sqrt{3}*Poles*\pi*n}\)</span></p><p>在定义反电动势系数时，要注意采用的是峰值还是有效值，以及对应的是rpm/min还是krpm/min。</p><p>反电动势系数1=反电动势幅值/转速n(对应V/rpm)</p><p>反电动势系数1=反电动势有效值/转速n(对应V/rpm)</p><p>反电动势系数2=反电动势幅值/转速n(对应V/krpm)</p><p>如果已知反电动势系数，可以直接求解磁链值。</p><p>对于表贴式电机，采用MTPA时，电磁转矩公式为：</p><p><span class="math inline">\(Te = \frac{3} {2}*Poles*\psi\)</span></p><p>其中：</p><p>Te：电磁转矩</p><p>Poles：电机极对数</p><p><span class="math inline">\(\psi\)</span>：电机永磁体磁链</p><p>iq：q轴电流</p><p>转矩系数定义为：</p><p><span class="math inline">\(Kt = \frac{Te} {iq}\)</span></p><p>则可得到 <span class="math inline">\(Kt=\frac{3}{2}*Poles*\psi\)</span></p><p>由此，可知转矩系数和反电动势系数中都包含磁链信息，因此通过磁链可以将转矩系数和反电动势系数联系起来。</p>]]></content>
    
    
    <categories>
      
      <category>电机参数关系</category>
      
    </categories>
    
    
    <tags>
      
      <tag>磁链</tag>
      
      <tag>反电动势系数</tag>
      
      <tag>转矩系数</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Svpwm-Overmodulation</title>
    <link href="/2024/10/17/Svpwm-Overmodulation/"/>
    <url>/2024/10/17/Svpwm-Overmodulation/</url>
    
    <content type="html"><![CDATA[<h4 id="过调制区域">过调制区域</h4><p>合成电压矢量图<br /><img src="/images/sector.png" /></p><p>六个基本电压矢量的幅值为 <span class="math inline">\(\frac{2} {3}V_{dc}\)</span> ，<span class="math inline">\(OC=\frac{2} {3}​Vdc​\)</span>，六边形内切圆为合成矢量最大圆形矢量轨迹，半径为 <spanclass="math inline">\(OB = \frac{V_{dc} }{\sqrt{3}}\)</span>。这个半径为 <span class="math inline">\(OB =\frac{V_{dc} } {\sqrt{3}}\)</span>​​的区域也被称作SVPWM的线性区域。在该线性区域内，所有参考电压矢量都能够通过SVPWM技术合成并跟随。而当参考电压矢量的幅值进一步增大时，电压圆轨迹上的某些部分将会超出最大矢量圆的范围，而此时SVPWM也进入了所谓的非线性调制区。在非线性调制区合成电压矢量所采用的调制方法，被称为过调制技术。合成的电压矢量是超不过六边形边界的，超不出正六边形的物理意义就是，我们不可能在一个为Ts的PWM周期内，实现两个非零矢量各自作用的时间T1与T2之和大于Ts。六边形内的矢量是包含了零矢量的，六边形上的以及六边形外的矢量的合成是不包含零矢量的。过调制技术是在传统的SVPWM技术上衍生出来的。传统的SVPWM的调制方法在过调制区不能准确的合成给定电压矢量，基本电压矢量的作用时间计算出来可能为负。因此，需要使用过调制技术使得输出电压矢量能够在幅值和相位上尽可能的反映出参考电压矢量的变化。在你给出了一个大于正六边形的内切圆半径长度的Vref的情况下，保证你这个Vref还是能旋转，同时，时刻会自动调整Vref的实际长度，以保证它的轨迹不超出正六边形。</p><h5 id="过调制一区">过调制一区</h5><p><img src="/images/overmodulation_I.png" />过调制一区即合成参考矢量幅值超过了最大内切圆（<spanclass="math inline">\(\frac{V_{dc}}{\sqrt{3}}\)</span>）但是在基本矢量V1~V6（<spanclass="math inline">\(\frac{2}{3}V_{dc}\)</span>）幅值内，对于上图中红色的轨迹，轨迹位于正六边形内部的1-2段，正常调制，为红色轨迹，2-3段路径超出了正六边形因此被拉回正六边形内部，为黑色2-3段路径，3-4段同1-2段为红色轨迹。</p><h5 id="过调制二区">过调制二区</h5><p><img src="/images/overmodulation_II.png" />过调制二区即合成参考矢量幅值超过了基本矢量V1~V6（<spanclass="math inline">\(\frac{2}{3}V_{dc}\)</span>）幅值，所有段轨迹都被拉回到正六边形边界，即为黑色轨迹。</p><h4 id="过调制算法">过调制算法：</h4><h5 id="算法1">算法1：</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*两个非零矢量的作用时间之和超过了开关周期时间Ts,对两个矢量作用时间都进行缩放*/</span><br><span class="hljs-keyword">if</span>((T1+T2)&gt;Ts)<br>&#123;<br>T1 = T1/(T1+T2);<br>T2 = T2/(T1+T2);<br>&#125;<br></code></pre></td></tr></table></figure><p>算法1，超过正六边形边界的Vref矢量轨迹会被拉回到正六边形边界，即无论Vref增大多少，最大只能到达正六边形边界，调制后的Vref矢量运行轨迹极限情况下为一个等速正六边形，根据矢量作用时间计算得来的三相PWM占空比极限情况下为梯形波。<img src="/images/overmudulation_wave.png" /></p><h5 id="算法2">算法2：</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">Modulate_Vec_Tim</span><span class="hljs-params">(<span class="hljs-type">int32_t</span> *T1, <span class="hljs-type">int32_t</span> *T2)</span> <span class="hljs-comment">// 输入的T1,T2是两个非零矢量的工作时间长度，这里要求线性区加和不大于32768</span><br>&#123;<br>    <span class="hljs-type">int32_t</span> P1 = *T1, P2 = *T2;<br>    <span class="hljs-type">int32_t</span> PSum = P1 + P2;<br><br>    <span class="hljs-keyword">if</span> (PSum &gt; Ts) <span class="hljs-comment">// 过调制模块,1区</span><br>    &#123;<br>        P1 = Ts * P1 / PSum;<br>        P2 = Ts * P2 / PSum;<br>        <span class="hljs-keyword">if</span> (PSum &gt; Ts*<span class="hljs-number">1.154</span>) <span class="hljs-comment">// 过调制模块，2区，Ts*1.154过调制模块，大过1倍长度区，看P1,P2哪个大把时间往哪边偏移,构造线性连续偏移即可</span><br>        &#123;<br>            <span class="hljs-type">int32_t</span> PsumDelta = PSum - Ts*<span class="hljs-number">1.154</span>;<br>            <span class="hljs-keyword">if</span> (P1 &gt; P2)<br>            &#123;<br>                <span class="hljs-keyword">if</span> (P2 &lt; PsumDelta)<br>                &#123;<br>                    P1 = Ts;<br>                    P2 = <span class="hljs-number">0</span>;<br>                &#125;<br>                <span class="hljs-keyword">else</span><br>                &#123;<br>                    P1 += PsumDelta;<br>                    P2 -= PsumDelta;<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">else</span><br>            &#123;<br>                <span class="hljs-keyword">if</span> (P1 &lt; PsumDelta)<br>                &#123;<br>                    P1 = <span class="hljs-number">0</span>;<br>                    P2 = Ts;<br>                &#125;<br>                <span class="hljs-keyword">else</span><br>                &#123;<br>                    P1 -= PsumDelta;<br>                    P2 += PsumDelta;<br>                &#125;<br>            &#125;<br>        &#125;<br>        *T1 = P1; <span class="hljs-comment">// 赋值操作</span><br>        *T2 = P2;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>算法2包含算法1，当位于调制一区时采用算法1部分，调制极限为梯形波，当Vref幅值超过基本电压矢量时（即位于调制2区），采用变速控制，即Vref矢量在基本矢量上的作用时间久，而在正六边形的边界快速移动，极限情况下近似于六步换向，其三相PWM占空比极限情况下为方波。<img src="/images/overmudulation_square_wave.png" /></p><p>最小相角过调制</p><p>单模式过调制：</p><p>双模式过调制：</p><p>逆变器在六步方波模式运行时的基波电压峰值：<spanclass="math inline">\(\frac{V_{dc}}{\frac{2}{\pi}}\)</span>，大于正六边形内切圆半径。</p>]]></content>
    
    
    <categories>
      
      <category>SVPWM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>svpwm-overmodulation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Svpwm-Vector-action-time</title>
    <link href="/2024/10/17/Svpwm-Vector-action-time/"/>
    <url>/2024/10/17/Svpwm-Vector-action-time/</url>
    
    <content type="html"><![CDATA[<ol type="1"><li>计算矢量作用时间，定时器配置中，在中心对齐模式下对应于PWM mode1，矢量切换点之前为有效电平，切换点之后为无效电平。</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> SQRT_3 1.732051</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> Ts (PWM_PERIOD * 2)</span><br><br><span class="hljs-type">uint8_t</span> bSector;<br><span class="hljs-type">int32_t</span> wX, wY, wZ, wUAlpha, wUBeta;<br><span class="hljs-type">int32_t</span> Ta, Tb, Tc;<br><span class="hljs-type">int32_t</span> wTimePhA = <span class="hljs-number">0</span>, wTimePhB = <span class="hljs-number">0</span>, wTimePhC = <span class="hljs-number">0</span>;<br><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span></span><br><span class="hljs-class">&#123;</span><br>    <span class="hljs-type">int16_t</span> alpha;<br>    <span class="hljs-type">int16_t</span> beta;<br>&#125; <span class="hljs-type">alphabeta_t</span>;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">SVPWM</span><span class="hljs-params">(<span class="hljs-type">alphabeta_t</span> Stat_Volt_Input)</span><br>&#123;<br>    wUAlpha = (<span class="hljs-type">int32_t</span>)(SQRT_3 * Ts * Stat_Volt_Input.alpha * SQRT_3) &gt;&gt; <span class="hljs-number">15</span>;<br>    wUBeta = (<span class="hljs-type">int32_t</span>)(Ts * Stat_Volt_Input.beta * SQRT_3) &gt;&gt; <span class="hljs-number">15</span>;<br><br>    wX = wUBeta;<br>    wY = (wUBeta + wUAlpha) &gt;&gt; <span class="hljs-number">1</span>;<br>    wZ = (wUBeta - wUAlpha) &gt;&gt; <span class="hljs-number">1</span>;<br><br>    <span class="hljs-comment">// Calculate the vector action time</span><br>    <span class="hljs-keyword">if</span> (wY &lt; <span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (wZ &lt; <span class="hljs-number">0</span>)<br>        &#123;<br>            bSector = SECTOR_5;<br>            Ta = (Ts &gt;&gt; <span class="hljs-number">1</span>) + ((-wZ + wY) &gt;&gt; <span class="hljs-number">1</span>);<br>            Tb = Ta + wZ;<br>            Tc = Ta - wY;<br>            wTimePhA = Ta &gt;&gt; <span class="hljs-number">1</span>;<br>            wTimePhB = Tb &gt;&gt; <span class="hljs-number">1</span>;<br>            wTimePhC = Tc &gt;&gt; <span class="hljs-number">1</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-comment">// wZ &gt;= 0</span><br>        &#123;<br>            <span class="hljs-keyword">if</span> (wX &lt;= <span class="hljs-number">0</span>)<br>            &#123;<br>                bSector = SECTOR_4;<br>                Ta = (Ts &gt;&gt; <span class="hljs-number">1</span>) + ((wX - wZ) &gt;&gt; <span class="hljs-number">1</span>);<br>                Tb = Ta + wZ;<br>                Tc = Tb - wX;<br>                wTimePhA = Ta &gt;&gt; <span class="hljs-number">1</span>;<br>                wTimePhB = Tb &gt;&gt; <span class="hljs-number">1</span>;<br>                wTimePhC = Tc &gt;&gt; <span class="hljs-number">1</span>;<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-comment">// wX &gt; 0</span><br>            &#123;<br>                bSector = SECTOR_3;<br>                Ta = (Ts &gt;&gt; <span class="hljs-number">1</span>) + ((wY - wX) &gt;&gt; <span class="hljs-number">1</span>);<br>                Tc = Ta - wY;<br>                Tb = Tc + wX;<br>                wTimePhA = Ta &gt;&gt; <span class="hljs-number">1</span>;<br>                wTimePhB = Tb &gt;&gt; <span class="hljs-number">1</span>;<br>                wTimePhC = Tc &gt;&gt; <span class="hljs-number">1</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-comment">// wY &gt; 0</span><br>    &#123;<br>        <span class="hljs-keyword">if</span> (wZ &gt;= <span class="hljs-number">0</span>)<br>        &#123;<br>            bSector = SECTOR_2;<br>            Ta = (Ts &gt;&gt; <span class="hljs-number">1</span>) + ((wY - wZ) &gt;&gt; <span class="hljs-number">1</span>);<br>            Tb = Ta + wZ;<br>            Tc = Ta - wY;<br>            wTimePhA = Ta &gt;&gt; <span class="hljs-number">1</span>;<br>            wTimePhB = Tb &gt;&gt; <span class="hljs-number">1</span>;<br>            wTimePhC = Tc &gt;&gt; <span class="hljs-number">1</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-comment">// wZ &lt; 0</span><br>        &#123;<br>            <span class="hljs-keyword">if</span> (wX &lt;= <span class="hljs-number">0</span>)<br>            &#123;<br>                bSector = SECTOR_6;<br>                Ta = (Ts &gt;&gt; <span class="hljs-number">1</span>) + ((wY - wX) &gt;&gt; <span class="hljs-number">1</span>);<br>                Tc = Ta - wY;<br>                Tb = Tc + wX;<br>                wTimePhA = Ta &gt;&gt; <span class="hljs-number">1</span>;<br>                wTimePhB = Tb &gt;&gt; <span class="hljs-number">1</span>;<br>                wTimePhC = Tc &gt;&gt; <span class="hljs-number">1</span>;<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-comment">// wX &gt; 0</span><br>            &#123;<br>                bSector = SECTOR_1;<br>                Ta = (Ts &gt;&gt; <span class="hljs-number">1</span>) + ((-wZ + wX) &gt;&gt; <span class="hljs-number">1</span>);<br>                Tb = Ta + wZ;<br>                Tc = Tb - wX;<br>                wTimePhA = Ta &gt;&gt; <span class="hljs-number">1</span>;<br>                wTimePhB = Tb &gt;&gt; <span class="hljs-number">1</span>;<br>                wTimePhC = Tc &gt;&gt; <span class="hljs-number">1</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">/* Load compare registers values */</span><br>    __HAL_TIM_SET_COMPARE(&amp;htim1, TIM_CHANNEL_1, wTimePhA);<br>    __HAL_TIM_SET_COMPARE(&amp;htim1, TIM_CHANNEL_2, wTimePhB);<br>    __HAL_TIM_SET_COMPARE(&amp;htim1, TIM_CHANNEL_3, wTimePhC);<br><br>    __HAL_TIM_SET_COMPARE(&amp;htim1, TIM_CHANNEL_4, <span class="hljs-number">5</span>); <span class="hljs-comment">// trigger next sampel point</span><br>&#125;<br></code></pre></td></tr></table></figure><ol start="2" type="1"><li>计算矢量切换点，定时器配置中，在中心对齐模式下对应于PWM mode2，矢量切换点之前为无效电平，切换点之后为有效电平。 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> SQRT_3 1.732051</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> Ts (PWM_PERIOD * 2)</span><br><br><span class="hljs-type">uint8_t</span> bSector;<br><span class="hljs-type">int32_t</span> wX, wY, wZ, wUAlpha, wUBeta;<br><span class="hljs-type">int32_t</span> wTimePhA = <span class="hljs-number">0</span>, wTimePhB = <span class="hljs-number">0</span>, wTimePhC = <span class="hljs-number">0</span>;<br><span class="hljs-type">int32_t</span> Tp1, Tp2, Tp3;<br><span class="hljs-type">int32_t</span> T1, T2, T3, T4, T5, T6;<br><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span></span><br><span class="hljs-class">&#123;</span><br>    <span class="hljs-type">int16_t</span> alpha;<br>    <span class="hljs-type">int16_t</span> beta;<br>&#125; <span class="hljs-type">alphabeta_t</span>;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">SVPWM</span><span class="hljs-params">(<span class="hljs-type">alphabeta_t</span> Stat_Volt_Input)</span><br>&#123;<br><br>    wUAlpha = (<span class="hljs-type">int32_t</span>)(SQRT_3 * Ts * Stat_Volt_Input.alpha * SQRT_3) &gt;&gt; <span class="hljs-number">15</span>;<br>    wUBeta = (<span class="hljs-type">int32_t</span>)(Ts * Stat_Volt_Input.beta * SQRT_3) &gt;&gt; <span class="hljs-number">15</span>;<br><br>    wX = wUBeta;<br>    wY = (wUBeta + wUAlpha) &gt;&gt; <span class="hljs-number">1</span>;<br>    wZ = (wUBeta - wUAlpha) &gt;&gt; <span class="hljs-number">1</span>;<br><br>    <span class="hljs-comment">// Calculate the vector action time</span><br>    <span class="hljs-keyword">if</span> (wY &lt; <span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (wZ &lt; <span class="hljs-number">0</span>)<br>        &#123;<br>            bSector = SECTOR_5;<br>            T5 = -Y;<br>            T6 = -Z;<br>            Tp1 = (Ts - T5 - T6) &gt;&gt; <span class="hljs-number">2</span>;<br>            Tp2 = Tp1 + (T5 &gt;&gt; <span class="hljs-number">1</span>);<br>            Tp3 = Tp2 + (T6 &gt;&gt; <span class="hljs-number">1</span>);<br>            wTimePhA = Tp2;<br>            wTimePhB = Tp3;<br>            wTimePhC = Tp1;<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-comment">// wZ &gt;= 0</span><br>        &#123;<br>            <span class="hljs-keyword">if</span> (wX &lt;= <span class="hljs-number">0</span>)<br>            &#123;<br>                bSector = SECTOR_4;<br>                T4 = Z;<br>                T5 = -X;<br>                Tp1 = (Ts - T4 - T5) &gt;&gt; <span class="hljs-number">2</span>;<br>                Tp2 = Tp1 + (T4 &gt;&gt; <span class="hljs-number">1</span>);<br>                Tp3 = Tp2 + (T5 &gt;&gt; <span class="hljs-number">1</span>);<br>                wTimePhA = Tp3;<br>                wTimePhB = Tp2;<br>                wTimePhC = Tp1;<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-comment">// wX &gt; 0</span><br>            &#123;<br>                bSector = SECTOR_3;<br>                T3 = X;<br>                T4 = -Y;<br>                Tp1 = (Ts - T3 - T4) &gt;&gt; <span class="hljs-number">2</span>;<br>                Tp2 = Tp1 + (T3 &gt;&gt; <span class="hljs-number">1</span>);<br>                Tp3 = Tp2 + (T4 &gt;&gt; <span class="hljs-number">1</span>);<br>                wTimePhA = Tp3;<br>                wTimePhB = Tp1;<br>                wTimePhC = Tp2;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-comment">// wY &gt; 0</span><br>    &#123;<br>        <span class="hljs-keyword">if</span> (wZ &gt;= <span class="hljs-number">0</span>)<br>        &#123;<br>            bSector = SECTOR_2;<br>            T2 = Y;<br>            T3 = Z;<br>            Tp1 = (Ts - T2 - T3) &gt;&gt; <span class="hljs-number">2</span>;<br>            Tp2 = Tp1 + (T2 &gt;&gt; <span class="hljs-number">1</span>);<br>            Tp3 = Tp2 + (T3 &gt;&gt; <span class="hljs-number">1</span>);<br>            wTimePhA = Tp2;<br>            wTimePhB = Tp1;<br>            wTimePhC = Tp3;<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-comment">// wZ &lt; 0</span><br>        &#123;<br>            <span class="hljs-keyword">if</span> (wX &lt;= <span class="hljs-number">0</span>)<br>            &#123;<br>                bSector = SECTOR_6;<br>                T1 = Y;<br>                T6 = -X;<br>                Tp1 = (Ts - T1 - T6) &gt;&gt; <span class="hljs-number">2</span>;<br>                Tp2 = Tp1 + (T1 &gt;&gt; <span class="hljs-number">1</span>);<br>                Tp3 = Tp2 + (T6 &gt;&gt; <span class="hljs-number">1</span>);<br>                wTimePhA = Tp1;<br>                wTimePhB = Tp3;<br>                wTimePhC = Tp2;<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-comment">// wX &gt; 0</span><br>            &#123;<br>                bSector = SECTOR_1;<br>                T1 = -Z;<br>                T2 = X;<br>                Tp1 = (Ts - T1 - T2) &gt;&gt; <span class="hljs-number">2</span>;<br>                Tp2 = Tp1 + (T1 &gt;&gt; <span class="hljs-number">1</span>);<br>                Tp3 = Tp2 + (T2 &gt;&gt; <span class="hljs-number">1</span>);<br>                wTimePhA = Tp1;<br>                wTimePhB = Tp2;<br>                wTimePhC = Tp3;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">/* Load compare registers values */</span><br>    __HAL_TIM_SET_COMPARE(&amp;htim1, TIM_CHANNEL_1, PWM_PERIOD - wTimePhA);<br>    __HAL_TIM_SET_COMPARE(&amp;htim1, TIM_CHANNEL_2, PWM_PERIOD - wTimePhB);<br>    __HAL_TIM_SET_COMPARE(&amp;htim1, TIM_CHANNEL_3, PWM_PERIOD - wTimePhC);<br><br>    __HAL_TIM_SET_COMPARE(&amp;htim1, TIM_CHANNEL_4, PWM_PERIOD - <span class="hljs-number">5</span>); <span class="hljs-comment">// trigger next sampel point</span><br>&#125;<br></code></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <categories>
      
      <category>SVPWM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>svpwm占空比调制</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
