<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>adrc</title>
    <link href="/2024/10/19/adrc/"/>
    <url>/2024/10/19/adrc/</url>
    
    <content type="html"><![CDATA[<h3 id="源码分析">源码分析</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>电机弱磁理论</title>
    <link href="/2024/10/19/%E7%94%B5%E6%9C%BA%E5%BC%B1%E7%A3%81%E7%90%86%E8%AE%BA/"/>
    <url>/2024/10/19/%E7%94%B5%E6%9C%BA%E5%BC%B1%E7%A3%81%E7%90%86%E8%AE%BA/</url>
    
    <content type="html"><![CDATA[<h3 id="弱磁控制的原理">弱磁控制的原理</h3><p>解释一：</p><p>由于逆变器直流侧电压达到最大值后会引起电流调节器的饱和，为了获得较宽的调速范围，在基速以上高速运行时实现恒功率调速，需要对电动机进行弱磁控制。 PMSM弱磁控制的思想源自他励直流电动机的调磁控制，当他励直流电动机端电压达到最大电压时，只能通过降低电动机的励磁电流，改变励磁磁通，在保证电压平衡的条件下，使电动机能恒功率运行于更高的转速。也就是说，他励直流电动机可以通过降低励磁电流达到弱磁扩速的目的。对于PMSM而言，励磁磁动势因永磁体产生而无法调节，只能通过调节定子电流，即增加定子直轴去磁电流分量来维持高速运行时电压的平衡，达到弱磁扩速的目的。</p><p>解释二：</p><p>PMSM转动过程中，定子旋转磁场拖动转子磁场旋转的同时，又因为定子绕组线圈固定，相当于定子绕组线圈切割转子磁场，进而在定子绕组线圈中产生感应电动势，称为反电动势，PMSM转速越快，反电动势越大。相电压需要克服反电动势，相电压与反电动势差值提供产生电流，该电流大小影响转矩大小，当转速离开恒转矩区后就进入衡功率区，反电动势越大，电机转矩越小，当相电压与反电动势相同时，电机转矩将变得很小，也可以理解为转速无法继续提高。电机接受的最大电流和电压受到逆变器最大电流和电压的双重约束，当转速需要进一步提高，逆变器则不能提供更大的电流或电压。弱磁控制可以在不改变电机结构和逆变器容量的前提下提升永磁同步电机调速范围。在恒功率区需要电机以更高转速运行时，需要通过弱磁控制调节定子电流矢量来间接削弱转子励磁磁场进而减小反电动势，维持电压平衡，使电机转矩增大或转速增加。不同大小的转矩都对应不同的大小的恒转矩区和恒功率区，转矩越大，恒转矩区范围越小。<img src="/images/flux_weakening.png" />弱磁控制通常在高速恒功率区使用，电机稳定高速运转，MTPA在低速恒转矩区使用。也可理解为当输出电压幅值大于最大限值后，就由MTPA控制变为弱磁控制。</p><p>dq轴电压平衡方程如下：</p><ol type="1"><li><span class="math inline">\(\begin{cases} u_d=-w_eL_qi_q+R_si_d\\u_q=w_eL_di_d+w_e\psi_f+R_si_q \end{cases}\)</span></li></ol><p>当转速比较高的时候，电压平衡方程中的电阻电压分量（对应电机定子等效电阻压降）可以忽略，此时可以得到：</p><ol start="2" type="1"><li><span class="math inline">\(\begin{cases} u_d=-w_eL_qi_q\\u_q=w_eL_di_d+w_e\psi_f \end{cases}\)</span></li></ol><p>受逆变器输出电压的限制，PMSM稳定运行时，电压矢量幅值为：</p><ol start="3" type="1"><li><spanclass="math inline">\(u_s^2=u_d^2+u_q^2&lt;=u_{lim}^2\)</span></li></ol><p>取最大电压情况，将上述dq轴电压公式代入上式中，可得：</p><ol start="4" type="1"><li><spanclass="math inline">\((L_qi_q)^2+（L_di_d+\psi_f)^2=(u_{lim/w})^2\)</span></li></ol><p>由此式可知当输出电压达到极限值后，要想提升电角速度，只能通过调整dq轴电流来实现，因为PMSM的励磁是永磁体，所以其磁链无法调整。</p><p>永磁同步电动机矢量控制的电压、电流轨迹分析:在弱磁高性能调速时，在不同的工作区域内，由于控制规律的不同，为了获得最优的控制效果，通常会选择不同的电流、电压矢量轨迹轨迹，因此，非常有必要去分析了解此时的电流、电压矢量轨迹。</p><p>图1 <img src="/images/flux_weakening_circle.png"alt="alt text" /></p><h3 id="电压极限椭圆">电压极限椭圆：</h3><p>式(4)中 <spanclass="math inline">\(u_{lim}=\frac{u_{dc}}{\sqrt{3}}\)</span>是定子端相电压，u_{dc}为直流母线电压。当 <spanclass="math inline">\(L_d\ne L_q\)</span> 时，为一椭圆方程。当 <spanclass="math inline">\(L_d=L_q\)</span> 时，化简上式可得其圆心在(<spanclass="math inline">\(-\psi_f/L_d\)</span>,0)半径为 <spanclass="math inline">\(u_{lim}/(L_0w)\)</span>的圆方程：</p><ol start="5" type="1"><li><spanclass="math inline">\(i_q^2+(i_d+\psi_f/L_0)^2=[u_{lim/(L_0w)}]^2\)</span></li></ol><p>以椭圆方程为例说明，当电流调节器饱和后，定子端相电压为 <spanclass="math inline">\(u_s=u_{lim}\)</span>，此时转速w下对应的运行轨迹即为式(4)所示dq坐标系下的椭圆，并称其为转速w下的电压极限椭圆。易知在一定转速w下，定子电流只能运行于该椭圆轨迹内。并且随着转速w的增大，电压极限椭圆会逐渐缩小。</p><h3 id="电流极限圆">电流极限圆：</h3><p>受逆变器输出电流和电机本身额定电流的限制，PMSM稳定运行时，电流矢量幅值为：</p><ol start="6" type="1"><li><span class="math inline">\(i_s^2=i_d^2+i_q^2 \lei_{lim}^2\)</span></li></ol><p>由式(6)可以看出，电流矢量轨迹在dq轴坐标系下是以原点为圆心的圆，并称该圆为电流极限圆，如图1所示。电动机稳定运行时，定子电流矢量既不能超过电压极限椭圆，也不能超出电流极限圆，一定要在电压极限椭圆和电流极限椭圆内。如<span class="math inline">\(w=w_0\)</span> 时，电流矢量 <spanclass="math inline">\(i_s\)</span>的范围被限制在阴影区域内。</p><p>永磁同步电动机弱磁控制方法理论分析</p><p>由式(1)可以看出，当电动机电压达到逆变器输出电压的极限时，即 <spanclass="math inline">\(u_s=u_{lim}\)</span>，如果要继续升高转速则只能靠调节<span class="math inline">\(i_{d}\)</span> 和 <spanclass="math inline">\(i_{q}\)</span>来实现，这就是电动机“弱磁”运行方式。增加直轴去磁分量i_d和减小交轴电流分量<spanclass="math inline">\(i_{q}\)</span>，以维持电压平衡，从而得到弱磁效果。但是为了确保电流不超过极限值，应保证弱磁控制增加<span class="math inline">\(i_{d}\)</span>的同时必须相应减小 <spanclass="math inline">\(i_q\)</span>。以隐极电机 <spanclass="math inline">\(L_{d}=L_{q}\)</span>为例分析PMSM的弱磁控制过程。</p><p>MTPA：</p><p>图2 恒转矩与最大转矩/电流轨迹 <imgsrc="/images/flux_weakending_mtpa_spm.png" alt="alt text" /></p><p>易知隐极电机的恒转矩轨迹在 <span class="math inline">\(i_{d}\)</span>、<span class="math inline">\(i_{q}\)</span>平面上为一系列平行于d轴的水平线，其不仅关于d轴对称，而且在第二象限为正（运行于电动机状态），在第三象限为负（运行于制动状态）。</p><p>不论在第二象限还是第三象限，某指令值的恒转矩轨迹上的任一点所对应的定子电流矢量均导致相同值的电动机转矩。这就牵涉到寻求一个幅值最小的定子电流矢量的问题，因为定子电流越小，电动机效率越高，所需逆变器容量也越低。在<span class="math inline">\(i_{d}\)</span> 、<spanclass="math inline">\(i_{q}\)</span>平面图中，某指令值的恒转矩轨迹上距离坐标原点最近的点，即为产生该转矩时所需的最小电流的空间矢量。把产生不同转矩值所需的最小电流点连接起来，即形成电动机的最大转矩/电流轨迹。由此易知隐极电机的最大转矩/电流轨迹就是q轴。因此，隐极电机的<span class="math inline">\(i_{d} = 0\)</span>控制即为最大转矩/电流比控制。</p><p>图3 隐极电机定子电流矢量轨迹(<spanclass="math inline">\(-\psi_f/L_d\)</span> &lt; <spanclass="math inline">\(i_{lim}\)</span>) <imgsrc="/images/flux_weakending_4.png" alt="alt text" /> 图4永磁同步电机功率输出特性 <img src="/images/flux_weakening_5.png"alt="alt text" /> 图4 中区间1为 <spanclass="math inline">\(i_d=0\)</span>正常控制区间，区间2为弱磁升速控制区间。以 图3定子电流矢量轨迹分析隐极式PMSM的弱磁扩速控制过程。图3中A1点对应的转矩是<span class="math inline">\(T_{em1}\)</span>，是电动机在转速 <spanclass="math inline">\(w_1\)</span>时输出的最大转矩（电压和电流均达到极限值，故 <spanclass="math inline">\(w_1\)</span>即为电动机最大转矩时的转折速度）。转速升高到<spanclass="math inline">\(w_2（w_1&lt;w_2）\)</span>时，最大转矩/电流轨迹与电压极限椭圆相交于B点，对应的转矩为<spanclass="math inline">\(T_{em3}\)</span>，若此时定子电流矢量偏离最大转矩/电流轨迹由B点沿着电压极限椭圆移动到C点，在此过程中电流并没有达到极限值，但当移动到C 点时，将会输出更大的转矩<span class="math inline">\(T_{em2}（ T_{em2}&gt;T_{em3}）\)</span>，从而提高了电动机超过转折速度运行时的输出功率。如果要继续提高转速，则定子电流可以沿着电流极限圆由C点移动到A2点，但是转矩会下降。通过分析可以看出，定子电流矢量在从B →C→A2变化的过程中， <spanclass="math inline">\(i_d\)</span>逐步增大，削弱了永磁体磁通，在逆变器容量不变的情况下，达到了弱磁扩速的目的。并且转速越高，输出的转矩会越小。区间3 为到达A2（即输出达到最大输出功率）后如果仍需要扩速，则需按A2 → A3的轨迹变化。但若圆心坐标 <spanclass="math inline">\(（-\psi_f/L_d,0）\)</span> 落在电流极限圆外即<span class="math inline">\(-\psi_f/L_d&gt;i_{lim}\)</span>，则不存在此区间。 当电动机运行与某一转速w_e时，由电压平衡方程：</p><ol start="7" type="1"><li><spanclass="math inline">\(u_s=w_e\sqrt{(L_qi_q)^2+(L_di_d+\psi_f)^2}\)</span></li></ol><p>可得到弱磁控制电流矢量轨迹：</p><ol start="8" type="1"><li><spanclass="math inline">\(i_d=-\frac{\psi_f}{L_d}+\frac{1}{L_d}\sqrt{\frac{u_{lim}^2}{w_e^2}-(L_qi_q)^2}\)</span></li></ol><p>由式(8)可得转速表达式为：</p><ol start="9" type="1"><li><span class="math inline">\(\Omega=\frac{u_{lim}^2}{p\sqrt{(\psi_f+L_qi_q)^2+(L_qi_q)^2}}\)</span></li></ol><p>弱磁控制式即为式(8)，如图3所示，通过控制i_d可使逆变器输出功率不变，将电机运行范围扩大到高速区域。但在上述两种控制方案中，当电动机转速达到较高转速时，电机反电势增大，都将会导致定子端电压大于母线电压，迫使定子电流跟踪其指令值所需的电压差减小至0（甚至为负），此时逆变器的dq轴电流控制器都会开始饱和，此时dq轴电流控制器输出均是其限幅值从而失去控制，没有达到弱磁控制的目的。因此在实际应用中，PMSM的弱磁控制主要是在满足电压极限椭圆和电流极限圆的基础上，调整 <spanclass="math inline">\(i_d\)</span>、<spanclass="math inline">\(i_q\)</span>，控制电流矢量轨迹，避免电流调节器饱和，从而使PMSM由恒转矩调速平稳、快速地过渡到弱磁工作模式。</p><p>对于“迫使定子电流跟踪其指令值所需的电压差减小至0”的理解：定子电流指令值：这是由控制器设定的期望电流值，用于实现特定的电动机运行状态（如转矩、速度等）。</p><p>电压差：为了使定子电流达到其指令值，控制器需要施加一定的电压差（即定子端电压与反电势之差）。这个电压差驱动电流变化，克服电动机的阻抗和反电势。</p><p>电压差减小至0：当电动机转速高到一定程度时，反电势增大至接近甚至超过电源母线电压。此时，控制器能施加的电压差（定子端电压减去反电势）变得非常小，接近0。</p><p>电压差为负：如果反电势超过了母线电压，施加到定子的电压差就会变成负值。这意味着即使控制器尽力提高定子端电压，反电势依然导致电流无法按照指令值跟踪，因为电压差不足以推动所需的电流。</p><p>当出现上述情况时，逆变器的dq轴电流控制器由于电压差不足而进入饱和状态，无法再进一步控制电流。这种情况下，弱磁控制（用于高转速时减小磁场以提高转速）无法有效实施，导致控制器失去对电流的精确控制。</p><p>总结来说，这句话的意思是：当电动机转速很高时，由于反电势增大，控制器无法提供足够的电压差来维持所需的电流，从而导致电流控制器失去控制能力，无法实现预期的弱磁控制。</p><p>图5 隐极电机定子电流矢量轨迹 <img src="/images/flux_weakening_6.png"alt="alt text" /> 如图 5 示当电流PI调节器饱和后，电动机的定子端电压达到最大值，电流矢量 <spanclass="math inline">\(i_s\)</span> 达到电压极限圆上的A1点，使电动机电流失去控制。定子电流矢量轨迹将由电压极限方程式(5)和电流极限方程式(6)决定。此时若不加以控制<span class="math inline">\(i_s\)</span> 将脱离A1 ，可能会向D 点或向B点摆动。如果在A1 点能够控制 <span class="math inline">\(i_s\)</span>，使其 <span class="math inline">\(i_q\)</span> 逐渐减小，<spanclass="math inline">\(i_d\)</span> 逐渐向负增大，那么 <spanclass="math inline">\(i_s\)</span> 必然会 向左摆动，向C点靠近，使得反向直轴电流 <span class="math inline">\(i_d\)</span>抵消永磁体磁通。由式 <spanclass="math inline">\(u_s=w_e\sqrt{(L_qi_q)^2+(L_di_d+\psi_f)^2}\)</span>可知，这会使定子电压幅值 <span class="math inline">\(u_s\)</span>减小，<spanclass="math inline">\(u_s&lt;u_{lim}\)</span>，使调节器脱离饱和，与此同时，随着<span class="math inline">\(i_d\)</span> 的逐渐增大和 <spanclass="math inline">\(i_q\)</span> 的逐渐减小，转子速度范围会逐步扩大。实际进行弱磁控制时，主要需要考虑下面的情况：</p><p>①相关电流方程必须设定在最极端条件下均能运行，因为其运行在电机反电势极高的情况下，此时电流调节器己饱和，可利用的直流母线电压极小甚至为０;</p><p>②为保证电机稳定运行在弱磁高速区，需要进一步控制输入至电压逆变器的电压;</p><p>③相关的弱磁控制数据取决于电机运行时的电气特性，需要实时地更改这些数据。</p>]]></content>
    
    
    <categories>
      
      <category>flux weakening</category>
      
    </categories>
    
    
    <tags>
      
      <tag>flux</tag>
      
      <tag>weakening</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ladder</title>
    <link href="/2024/10/19/ladder/"/>
    <url>/2024/10/19/ladder/</url>
    
    <content type="html"><![CDATA[<p>思维直觉对于事情的判断首先是通过直觉的，直觉的构成包括个人认知，思维各种因素在内，当做一件事件的时候，个人直觉的判断和客观的事实结果有出入，这个时候就需要分析个人直觉判断和客观事实的出入体现在哪里，是个人直觉里的哪部分出现了认知错误或者说不足，这就是反馈，通过反馈去校正个人直觉，从而去完善个人直觉，我们把他当做自适应控制器，通过反馈也就是直觉和客观事实的误差来不断的修正控制器，就可以实现控制器对不同事情的精准控制（我们可以理解为解决事情）。学习的过程就是一个不断修正、补充、完善系统的过程，如果个人直觉对事物的判断和处理有偏差，要及时去查明原因，从而反馈自身来调整，才能达到学习的目的。</p><p>拒绝工程师思维（劳动命思维），所有事情都硬扣细节，要有大局意识，看到该看的。不要优柔寡断，该落地就落地，错过了就没了。 <ahref="https://www.bilibili.com/video/BV1SV4y1U7h5/?spm_id_from=333.337.search-card.all.click&amp;vd_source=f1fc43fc2fc199d3fd1af8b33f4f5991">拒绝工程师思维和优柔寡断</a>。</p><p>学习：</p><ol type="1"><li><p>取势=学习目的+学习本质</p><p>1.1 学习的目的（没有目的不叫学习）</p><ol type="a"><li><p>解决什么？要学什么？学到什么程度？</p></li><li><p>不带着目的学习，不叫学习</p></li><li><p>明确目的，抓大放小</p></li></ol><p>1.2 学习内容的本质规律（学习要抓本质，花 最少的时间做最正确的事）</p><ol type="a"><li><p>抓本质，是取势的捷径</p></li><li><p>不会抓本质，会事倍功半</p></li></ol><p>1.3 取势实操方法：四赢法</p><ol type="a"><li><p>搞懂本质</p></li><li><p>提取关键（关键术语，关键步骤，关键过程）</p></li><li><p>针对性去看</p></li><li><p>实操积累套路经验</p></li></ol></li><li><p>明道=记忆+理解+运用</p><ol type="a"><li><p>记忆就是重复频率，分散记忆，多次重复，交替记忆</p></li><li><p>理解前需要有记忆，学会将抽象概念与实际联系，抽象概念与抽象概念联系</p></li><li><p>运用就是先模仿再独立实现</p></li></ol></li><li><p>优术篇</p><ol type="a"><li><p>复盘迭代</p></li><li><p>发现问题，找到本质，给出解决办法（针对问题重点突破），分类汇总经验</p></li></ol></li></ol>]]></content>
    
    
    <categories>
      
      <category>意识流</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ladder</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>电控技术分级</title>
    <link href="/2024/10/19/%E7%94%B5%E6%8E%A7%E6%8A%80%E6%9C%AF%E5%88%86%E7%BA%A7/"/>
    <url>/2024/10/19/%E7%94%B5%E6%8E%A7%E6%8A%80%E6%9C%AF%E5%88%86%E7%BA%A7/</url>
    
    <content type="html"><![CDATA[<h1 id="一级能力">一级能力：</h1><p>熟悉电机坐标变化； FOC基本控制流程； 熟悉PID原理，可进行参数调整；了解基本的状态机逻辑； 掌握MCU的使用，熟悉底层配置；可以使用简易的环路demo运转电机，简单调节参数。</p><h1 id="二级能力">二级能力</h1><p>电机的动态数学模型、静态数学模型；对控制环路、控制理论要有一定的理论基础，理论和实践要做到一定的统一；除滑模外起码熟悉一种观测器；具有定期阅读文献的习惯，结合文献和公司代码库，完成关键问题的优化，能独立承担一部分开发工作；起码完参与了一个完整的项目开发，承担重要的模块编写和关键问题解决；提交解决的问题通过率高，尽量不存在解决一个问题引出多个问题的现象。</p><h1 id="三级能力">三级能力</h1><p>深刻理解FOC的基本原理，对于转子磁场定向控制、定子磁场定向，I-f标量控制，V-f标量控制，DTC等各种控制方法的优劣理解深刻；除了滑模之外，至少熟练应用两种以上的观测器；对于高频注入，包括旋转高频注入、脉振高频注入有深刻的理解；有定期阅读文献的习惯，为公司平台建设共享重要文档，独立主导项目的开发和解决大部分关键问题；精通simulink用于FOC控制系统的仿真，搭建平台用于辅助各种相关问题的解决；至少参与了2~3个完整的项目开发，至少主导了其中一个完整项目的开发。</p>]]></content>
    
    
    <categories>
      
      <category>技术分层</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ladder</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>磁链观测器</title>
    <link href="/2024/10/19/%E7%A3%81%E9%93%BE%E8%A7%82%E6%B5%8B%E5%99%A8/"/>
    <url>/2024/10/19/%E7%A3%81%E9%93%BE%E8%A7%82%E6%B5%8B%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<p>非线性磁链观测器的状态变量为磁链值，当观测的磁链值收敛于电机实际磁链值时，观测器收敛。SPM的 <span class="math inline">\(\alpha\beta\)</span> 轴电压方程：</p><p>（1） <span class="math inline">\(\begin{bmatrix}  u_\alpha\\  u_\beta  \end{bmatrix} = \begin{bmatrix} R+pL_d &amp;  0\\ 0&amp;R+pL_q \end{bmatrix}\begin{bmatrix} i_\alpha  \\ i_\beta\end{bmatrix}+ [w\psi_m]\begin{bmatrix} -sin\theta \\cos\theta\end{bmatrix}\)</span></p><p>将公式（1）进行变换得到：</p><p>（2） <span class="math inline">\(L\begin{bmatrix} \dot{i_\alpha} \\\dot{i_\beta}  \end{bmatrix}=-R_s\begin{bmatrix} i_\alpha\\i_\beta\end{bmatrix}+w\psi_m\begin{bmatrix}sin\theta\\-cos\theta  \end{bmatrix}+\begin{bmatrix} u_\alpha \\u_\beta\end{bmatrix}\)</span></p><p>状态空间方程：</p><p><span class="math inline">\(\left\{\begin{matrix}  \dot{x}=Ax+Bu\\  y=Cx \end{matrix}\right.\)</span></p><p>定义状态变量X：</p><p>（3） <span class="math inline">\(\begin{bmatrix}\dot{x1}\\\dot{x2}\end{bmatrix}=L\begin{bmatrix}\dot{i_\alpha}\\\dot{i_\beta}\end{bmatrix}-w\psi_m\begin{bmatrix} sin\theta\\-cos\theta\end{bmatrix}=\begin{bmatrix}y1\\y2\end{bmatrix}\)</span></p><p>（4） <spanclass="math inline">\(\begin{bmatrix}y1\\y2\end{bmatrix}=-R_s\begin{bmatrix}i_\alpha\\i_\beta\end{bmatrix}+\begin{bmatrix}u_\alpha\\u_\beta\end{bmatrix}\)</span></p><p>对式（3）两边进行积分可得：</p><p>（5） <spanclass="math inline">\(\begin{bmatrix}x1\\x2\end{bmatrix}=L\begin{bmatrix}i_\alpha\\i_\beta\end{bmatrix}+\psi_m\begin{bmatrix}cos\theta\\sin\theta\end{bmatrix}\)</span></p><p>因为w 是，所以积分后消去了w项。 定义空间向量eta(x):</p><p>（6） <spanclass="math inline">\(eta(x)=\begin{bmatrix}eta(x1)\\eta(x2)\end{bmatrix}=x-L\begin{bmatrix}i_\alpha\\i_\beta\end{bmatrix}=\psi_m\begin{bmatrix}cos\theta\\sin\theta\end{bmatrix}\)</span></p><p>观测器模型：</p><p><spanclass="math inline">\(\left\{\begin{matrix}  \dot{\hat{x}}=A\hat{x}+Bu+K(y-\hat{y})\\\hat{y}=C\hat{x} \end{matrix}\right.\)</span></p><p>非线性磁链观测器模型：</p><p>（7） <span class="math inline">\(\begin{bmatrix}\dot{\hat{x1}}\\\dot{\hat{x2}} \end{bmatrix}=\begin{bmatrix}y1 \\y2\end{bmatrix}+\frac{\gamma}{2}\begin{bmatrix}eta(x1)\\eta(x2)\end{bmatrix}\{ \psi_m^2-\left \|  eta(x)\right \|^2\}\)</span></p><p>当观测器收敛时有：</p><p><span class="math inline">\(\psi_m^2=\left \|  eta(x)\right \|^2\)</span></p><p>对式（7）进行离散化：</p><p>（8） <span class="math inline">\(\begin{bmatrix} \hat{x1(k)}\\\hat{x2(k)}\end{bmatrix}=T_s \left [ \begin{bmatrix}y1_{(k-1)}\\y2_{(k-1)}\end{bmatrix}+\frac{\gamma}{2}\begin{bmatrix}etax1_{(k-1)}\\etax2_{(k-1)}\end{bmatrix}\{   \psi_m^2-\left\|  eta(x)\right \| ^2\  \}  \right ] +\begin{bmatrix} \hat{x1_{(k-1)}}\\ \hat{x2_{(x-1)}}\end{bmatrix}\)</span></p><p>由此可得包含观测角度的sin、cos值： （9） <spanclass="math inline">\(\begin{bmatrix}cos{\hat{\theta}}\\sin{\hat{\theta}}\end{bmatrix}=\frac{1}{\psi_m}\left(\begin{bmatrix} \hat{x1_(k)} \\ \hat{x2_{(k)}}\end{bmatrix}-L\begin{bmatrix} i_\alpha \\ i_\beta \end{bmatrix} \right)\)</span></p><p>磁链观测器锁相环输入： <img src="/images/pll_input.png" />因为电机反电动势滞后于转子磁链90°，所以通过反电动势计算得出的相位需要补偿90°。</p><h3 id="源码分析">源码分析</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>观测器</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nolinear flux observer</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>转子磁链和反电动势的相位关系</title>
    <link href="/2024/10/19/%E8%BD%AC%E5%AD%90%E7%A3%81%E9%93%BE%E5%92%8C%E5%8F%8D%E7%94%B5%E5%8A%A8%E5%8A%BF%E7%9A%84%E7%9B%B8%E4%BD%8D%E5%85%B3%E7%B3%BB/"/>
    <url>/2024/10/19/%E8%BD%AC%E5%AD%90%E7%A3%81%E9%93%BE%E5%92%8C%E5%8F%8D%E7%94%B5%E5%8A%A8%E5%8A%BF%E7%9A%84%E7%9B%B8%E4%BD%8D%E5%85%B3%E7%B3%BB/</url>
    
    <content type="html"><![CDATA[<p>dq轴定子电压方程如下：</p><p><span class="math inline">\(\left\{\begin{matrix}  u_d =Ri_d+\frac{d}{dt}\psi_d -w_e\psi_q\\ u_q=Ri_q+\frac{d}{dt}\psi_q+w_e\psi_d \end{matrix} \right.\)</span></p><p>定子磁链方程如下：</p><p><span class="math inline">\(\left\{\begin{matrix}  \psi_d = L_di_d +\psi_f\\ \psi_q = L_qi_q \end{matrix}\right.\)</span></p><p>合并定子电压方程和定子磁链方程可得：</p><p><span class="math inline">\(\left\{\begin{matrix}  u_d =Ri_d+L_d\frac{d}{dt}i_d -w_eL_qi_q \\ u_q=Ri_q+L_q\frac{d}{dt}i_q+w_e(L_di_d+\psi_f) \end{matrix} \right.\)</span></p><p>转子磁链投影到定子alpha轴上，可得：</p><p><span class="math inline">\(\psi_{\alpha} = \psi_fcos\theta_e\)</span></p><p>假设电机的电角速度是w_e，初始相位为0，则磁链可以表示为：</p><p><spanclass="math inline">\(\psi_{\alpha}=\psi_fcos(w_et)\)</span></p><p>根据最基本的法拉第电磁感应定律，d轴上的磁链，切割定子绕组，会产生感应电动势，可以求得该磁链切割定子绕组产生的感应电动势为：</p><p><span class="math inline">\(e =\frac{d\psi_{\alpha}}{dt}=\frac{d(\psi_fcos\theta_e)}{dt}=\psi_f\frac{d(cos(w_et))}{dt}=-w_e\psi_fsin(w_et)=w_e\psi_fcos(\theta_e+\frac{\pi}{2})\)</span></p><p>由此可知，相对于磁链的当前相位或者说角度而言，磁链切割绕组所产生的反电动势的相位超前磁链90°。因此d轴磁链切割定子绕组产生的反电动势位于q轴位置。在使用反电动势估算得出转子角度信息时，要减去90°的超前相位。</p>]]></content>
    
    
    <categories>
      
      <category>电机参数关系</category>
      
    </categories>
    
    
    <tags>
      
      <tag>磁链</tag>
      
      <tag>反电动势</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2024/10/19/hello-world/"/>
    <url>/2024/10/19/hello-world/</url>
    
    <content type="html"><![CDATA[<p>https://whitebear.zeabur.app</p><h1 id="fluid使用教程">fluid使用教程</h1><p>https://github.com/fluid-dev/hexo-theme-fluid</p><h1 id="注意">注意</h1><h1 id="配置fluid可按照fluid-yml里的链接来做">配置fluid可按照fluidyml里的链接来做</h1><h1id="支持latex需要安装pandoc独立软件">支持latex需要安装pandoc（独立软件）</h1><h1id="在初始化hexo时一定要以管理员方式来操作用npm来实现避免错误">在初始化hexo时，一定要以管理员方式来操作，用npm来实现，避免错误</h1><h1 id="部署时要开梯子才能访问github">部署时要开梯子才能访问github</h1><p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your veryfirst post. Check <a href="https://hexo.io/docs/">documentation</a> formore info. If you get any problems when using Hexo, you can find theanswer in <ahref="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> oryou can ask me on <ahref="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="quick-start">Quick Start</h2><h3 id="create-a-new-post">Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <ahref="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="run-server">Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="generate-static-files">Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <ahref="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="deploy-to-remote-sites">Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <ahref="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>磁链、转矩系数Kt、反电势系数Ke的关系</title>
    <link href="/2024/10/18/%E7%A3%81%E9%93%BE%E3%80%81%E8%BD%AC%E7%9F%A9%E7%B3%BB%E6%95%B0Kt%E3%80%81%E5%8F%8D%E7%94%B5%E5%8A%BF%E7%B3%BB%E6%95%B0Ke%E7%9A%84%E5%85%B3%E7%B3%BB/"/>
    <url>/2024/10/18/%E7%A3%81%E9%93%BE%E3%80%81%E8%BD%AC%E7%9F%A9%E7%B3%BB%E6%95%B0Kt%E3%80%81%E5%8F%8D%E7%94%B5%E5%8A%BF%E7%B3%BB%E6%95%B0Ke%E7%9A%84%E5%85%B3%E7%B3%BB/</url>
    
    <content type="html"><![CDATA[<p>磁链<span class="math inline">\(\psi\)</span> =空载反电动势幅值/电角频率（rad/s）</p><p><span class="math inline">\(\psi = \frac{E_{an-peak}}{w_e} =\frac{30*E_{an-peak}}{Poles * \pi * n}\)</span></p><p>其中：</p><p><spanclass="math inline">\(E_{an-peak}\)</span>：相反电动势幅值（峰值），单位 V</p><p><span class="math inline">\(w_e\)</span>：电角频率 ，单位 rad/s</p><p><span class="math inline">\(\psi\)</span>：电机磁链 ，单位 wb</p><p>相反电动势峰值和线反电动势峰值的关系：</p><p><span class="math inline">\(E_{an-peak} = \frac{E_{ab-peak}}{\sqrt{3}}\)</span></p><p>线反电动势峰值和线反电动势有效值的关系：</p><p><span class="math inline">\(E_{ab-peak}=E_{ab-rms}*\sqrt{2}\)</span></p><p><span class="math inline">\(w_e = Poles *2*\pi*\frac{n}{60}\)</span></p><p>其中：</p><p><span class="math inline">\(E_{ab-peak}\)</span>：线反电动势峰值，单位 V</p><p>n：电机机械转速 ，单位 rpm/min</p><p>磁链<spanclass="math inline">\(\psi\)</span>和线反电动势峰值的关系：</p><p><span class="math inline">\(\psi = \frac{30*E_{ab-peak} }{\sqrt{3}*Poles*\pi*n}\)</span></p><p>在定义反电动势系数时，要注意采用的是峰值还是有效值，以及对应的是rpm/min还是krpm/min。</p><p>反电动势系数1=反电动势幅值/转速n(对应V/rpm)</p><p>反电动势系数1=反电动势有效值/转速n(对应V/rpm)</p><p>反电动势系数2=反电动势幅值/转速n(对应V/krpm)</p><p>如果已知反电动势系数，可以直接求解磁链值。</p><p>对于表贴式电机，采用MTPA时，电磁转矩公式为：</p><p><span class="math inline">\(Te = \frac{3} {2}*Poles*\psi\)</span></p><p>其中：</p><p>Te：电磁转矩</p><p>Poles：电机极对数</p><p><span class="math inline">\(\psi\)</span>：电机永磁体磁链</p><p>iq：q轴电流</p><p>转矩系数定义为：</p><p><span class="math inline">\(Kt = \frac{Te} {iq}\)</span></p><p>则可得到 <span class="math inline">\(Kt=\frac{3}{2}*Poles*\psi\)</span></p><p>由此，可知转矩系数和反电动势系数中都包含磁链信息，因此通过磁链可以将转矩系数和反电动势系数联系起来。</p>]]></content>
    
    
    <categories>
      
      <category>电机参数关系</category>
      
    </categories>
    
    
    <tags>
      
      <tag>磁链</tag>
      
      <tag>反电动势系数</tag>
      
      <tag>转矩系数</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Svpwm-Overmodulation</title>
    <link href="/2024/10/17/Svpwm-Overmodulation/"/>
    <url>/2024/10/17/Svpwm-Overmodulation/</url>
    
    <content type="html"><![CDATA[<h4 id="过调制区域">过调制区域</h4><p>合成电压矢量图<br /><img src="/images/sector.png" /></p><p>六个基本电压矢量的幅值为 <span class="math inline">\(\frac{2} {3}V_{dc}\)</span> ，<span class="math inline">\(OC=\frac{2} {3}​Vdc​\)</span>，六边形内切圆为合成矢量最大圆形矢量轨迹，半径为 <spanclass="math inline">\(OB = \frac{V_{dc} }{\sqrt{3}}\)</span>。这个半径为 <span class="math inline">\(OB =\frac{V_{dc} } {\sqrt{3}}\)</span>​​的区域也被称作SVPWM的线性区域。在该线性区域内，所有参考电压矢量都能够通过SVPWM技术合成并跟随。而当参考电压矢量的幅值进一步增大时，电压圆轨迹上的某些部分将会超出最大矢量圆的范围，而此时SVPWM也进入了所谓的非线性调制区。在非线性调制区合成电压矢量所采用的调制方法，被称为过调制技术。合成的电压矢量是超不过六边形边界的，超不出正六边形的物理意义就是，我们不可能在一个为Ts的PWM周期内，实现两个非零矢量各自作用的时间T1与T2之和大于Ts。六边形内的矢量是包含了零矢量的，六边形上的以及六边形外的矢量的合成是不包含零矢量的。过调制技术是在传统的SVPWM技术上衍生出来的。传统的SVPWM的调制方法在过调制区不能准确的合成给定电压矢量，基本电压矢量的作用时间计算出来可能为负。因此，需要使用过调制技术使得输出电压矢量能够在幅值和相位上尽可能的反映出参考电压矢量的变化。在你给出了一个大于正六边形的内切圆半径长度的Vref的情况下，保证你这个Vref还是能旋转，同时，时刻会自动调整Vref的实际长度，以保证它的轨迹不超出正六边形。</p><h5 id="过调制一区">过调制一区</h5><p><img src="/images/overmodulation_I.png" />过调制一区即合成参考矢量幅值超过了最大内切圆（<spanclass="math inline">\(\frac{V_{dc}}{\sqrt{3}}\)</span>）但是在基本矢量V1~V6（<spanclass="math inline">\(\frac{2}{3}V_{dc}\)</span>）幅值内，对于上图中红色的轨迹，轨迹位于正六边形内部的1-2段，正常调制，为红色轨迹，2-3段路径超出了正六边形因此被拉回正六边形内部，为黑色2-3段路径，3-4段同1-2段为红色轨迹。</p><h5 id="过调制二区">过调制二区</h5><p><img src="/images/overmodulation_II.png" />过调制二区即合成参考矢量幅值超过了基本矢量V1~V6（<spanclass="math inline">\(\frac{2}{3}V_{dc}\)</span>）幅值，所有段轨迹都被拉回到正六边形边界，即为黑色轨迹。</p><h4 id="过调制算法">过调制算法：</h4><h5 id="算法1">算法1：</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*两个非零矢量的作用时间之和超过了开关周期时间Ts,对两个矢量作用时间都进行缩放*/</span><br><span class="hljs-keyword">if</span>((T1+T2)&gt;Ts)<br>&#123;<br>T1 = T1/(T1+T2);<br>T2 = T2/(T1+T2);<br>&#125;<br></code></pre></td></tr></table></figure><p>算法1，超过正六边形边界的Vref矢量轨迹会被拉回到正六边形边界，即无论Vref增大多少，最大只能到达正六边形边界，调制后的Vref矢量运行轨迹极限情况下为一个等速正六边形，根据矢量作用时间计算得来的三相PWM占空比极限情况下为梯形波。<img src="/images/overmudulation_wave.png" /></p><h5 id="算法2">算法2：</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">Modulate_Vec_Tim</span><span class="hljs-params">(<span class="hljs-type">int32_t</span> *T1, <span class="hljs-type">int32_t</span> *T2)</span> <span class="hljs-comment">// 输入的T1,T2是两个非零矢量的工作时间长度，这里要求线性区加和不大于32768</span><br>&#123;<br>    <span class="hljs-type">int32_t</span> P1 = *T1, P2 = *T2;<br>    <span class="hljs-type">int32_t</span> PSum = P1 + P2;<br><br>    <span class="hljs-keyword">if</span> (PSum &gt; Ts) <span class="hljs-comment">// 过调制模块,1区</span><br>    &#123;<br>        P1 = Ts * P1 / PSum;<br>        P2 = Ts * P2 / PSum;<br>        <span class="hljs-keyword">if</span> (PSum &gt; Ts*<span class="hljs-number">1.154</span>) <span class="hljs-comment">// 过调制模块，2区，Ts*1.154过调制模块，大过1倍长度区，看P1,P2哪个大把时间往哪边偏移,构造线性连续偏移即可</span><br>        &#123;<br>            <span class="hljs-type">int32_t</span> PsumDelta = PSum - Ts*<span class="hljs-number">1.154</span>;<br>            <span class="hljs-keyword">if</span> (P1 &gt; P2)<br>            &#123;<br>                <span class="hljs-keyword">if</span> (P2 &lt; PsumDelta)<br>                &#123;<br>                    P1 = Ts;<br>                    P2 = <span class="hljs-number">0</span>;<br>                &#125;<br>                <span class="hljs-keyword">else</span><br>                &#123;<br>                    P1 += PsumDelta;<br>                    P2 -= PsumDelta;<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">else</span><br>            &#123;<br>                <span class="hljs-keyword">if</span> (P1 &lt; PsumDelta)<br>                &#123;<br>                    P1 = <span class="hljs-number">0</span>;<br>                    P2 = Ts;<br>                &#125;<br>                <span class="hljs-keyword">else</span><br>                &#123;<br>                    P1 -= PsumDelta;<br>                    P2 += PsumDelta;<br>                &#125;<br>            &#125;<br>        &#125;<br>        *T1 = P1; <span class="hljs-comment">// 赋值操作</span><br>        *T2 = P2;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>算法2包含算法1，当位于调制一区时采用算法1部分，调制极限为梯形波，当Vref幅值超过基本电压矢量时（即位于调制2区），采用变速控制，即Vref矢量在基本矢量上的作用时间久，而在正六边形的边界快速移动，极限情况下近似于六步换向，其三相PWM占空比极限情况下为方波。<img src="/images/overmudulation_square_wave.png" /></p><p>最小相角过调制</p><p>单模式过调制：</p><p>双模式过调制：</p><p>逆变器在六步方波模式运行时的基波电压峰值：<spanclass="math inline">\(\frac{V_{dc}}{\frac{2}{\pi}}\)</span>，大于正六边形内切圆半径。</p>]]></content>
    
    
    <categories>
      
      <category>SVPWM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>svpwm-overmodulation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Svpwm-Vector-action-time</title>
    <link href="/2024/10/17/Svpwm-Vector-action-time/"/>
    <url>/2024/10/17/Svpwm-Vector-action-time/</url>
    
    <content type="html"><![CDATA[<ol type="1"><li>计算矢量作用时间，定时器配置中，在中心对齐模式下对应于PWM mode1，矢量切换点之前为有效电平，切换点之后为无效电平。</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> SQRT_3 1.732051</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> Ts (PWM_PERIOD * 2)</span><br><br><span class="hljs-type">uint8_t</span> bSector;<br><span class="hljs-type">int32_t</span> wX, wY, wZ, wUAlpha, wUBeta;<br><span class="hljs-type">int32_t</span> Ta, Tb, Tc;<br><span class="hljs-type">int32_t</span> wTimePhA = <span class="hljs-number">0</span>, wTimePhB = <span class="hljs-number">0</span>, wTimePhC = <span class="hljs-number">0</span>;<br><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span></span><br><span class="hljs-class">&#123;</span><br>    <span class="hljs-type">int16_t</span> alpha;<br>    <span class="hljs-type">int16_t</span> beta;<br>&#125; <span class="hljs-type">alphabeta_t</span>;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">SVPWM</span><span class="hljs-params">(<span class="hljs-type">alphabeta_t</span> Stat_Volt_Input)</span><br>&#123;<br>    wUAlpha = (<span class="hljs-type">int32_t</span>)(SQRT_3 * Ts * Stat_Volt_Input.alpha * SQRT_3) &gt;&gt; <span class="hljs-number">15</span>;<br>    wUBeta = (<span class="hljs-type">int32_t</span>)(Ts * Stat_Volt_Input.beta * SQRT_3) &gt;&gt; <span class="hljs-number">15</span>;<br><br>    wX = wUBeta;<br>    wY = (wUBeta + wUAlpha) &gt;&gt; <span class="hljs-number">1</span>;<br>    wZ = (wUBeta - wUAlpha) &gt;&gt; <span class="hljs-number">1</span>;<br><br>    <span class="hljs-comment">// Calculate the vector action time</span><br>    <span class="hljs-keyword">if</span> (wY &lt; <span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (wZ &lt; <span class="hljs-number">0</span>)<br>        &#123;<br>            bSector = SECTOR_5;<br>            Ta = (Ts &gt;&gt; <span class="hljs-number">1</span>) + ((-wZ + wY) &gt;&gt; <span class="hljs-number">1</span>);<br>            Tb = Ta + wZ;<br>            Tc = Ta - wY;<br>            wTimePhA = Ta &gt;&gt; <span class="hljs-number">1</span>;<br>            wTimePhB = Tb &gt;&gt; <span class="hljs-number">1</span>;<br>            wTimePhC = Tc &gt;&gt; <span class="hljs-number">1</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-comment">// wZ &gt;= 0</span><br>        &#123;<br>            <span class="hljs-keyword">if</span> (wX &lt;= <span class="hljs-number">0</span>)<br>            &#123;<br>                bSector = SECTOR_4;<br>                Ta = (Ts &gt;&gt; <span class="hljs-number">1</span>) + ((wX - wZ) &gt;&gt; <span class="hljs-number">1</span>);<br>                Tb = Ta + wZ;<br>                Tc = Tb - wX;<br>                wTimePhA = Ta &gt;&gt; <span class="hljs-number">1</span>;<br>                wTimePhB = Tb &gt;&gt; <span class="hljs-number">1</span>;<br>                wTimePhC = Tc &gt;&gt; <span class="hljs-number">1</span>;<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-comment">// wX &gt; 0</span><br>            &#123;<br>                bSector = SECTOR_3;<br>                Ta = (Ts &gt;&gt; <span class="hljs-number">1</span>) + ((wY - wX) &gt;&gt; <span class="hljs-number">1</span>);<br>                Tc = Ta - wY;<br>                Tb = Tc + wX;<br>                wTimePhA = Ta &gt;&gt; <span class="hljs-number">1</span>;<br>                wTimePhB = Tb &gt;&gt; <span class="hljs-number">1</span>;<br>                wTimePhC = Tc &gt;&gt; <span class="hljs-number">1</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-comment">// wY &gt; 0</span><br>    &#123;<br>        <span class="hljs-keyword">if</span> (wZ &gt;= <span class="hljs-number">0</span>)<br>        &#123;<br>            bSector = SECTOR_2;<br>            Ta = (Ts &gt;&gt; <span class="hljs-number">1</span>) + ((wY - wZ) &gt;&gt; <span class="hljs-number">1</span>);<br>            Tb = Ta + wZ;<br>            Tc = Ta - wY;<br>            wTimePhA = Ta &gt;&gt; <span class="hljs-number">1</span>;<br>            wTimePhB = Tb &gt;&gt; <span class="hljs-number">1</span>;<br>            wTimePhC = Tc &gt;&gt; <span class="hljs-number">1</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-comment">// wZ &lt; 0</span><br>        &#123;<br>            <span class="hljs-keyword">if</span> (wX &lt;= <span class="hljs-number">0</span>)<br>            &#123;<br>                bSector = SECTOR_6;<br>                Ta = (Ts &gt;&gt; <span class="hljs-number">1</span>) + ((wY - wX) &gt;&gt; <span class="hljs-number">1</span>);<br>                Tc = Ta - wY;<br>                Tb = Tc + wX;<br>                wTimePhA = Ta &gt;&gt; <span class="hljs-number">1</span>;<br>                wTimePhB = Tb &gt;&gt; <span class="hljs-number">1</span>;<br>                wTimePhC = Tc &gt;&gt; <span class="hljs-number">1</span>;<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-comment">// wX &gt; 0</span><br>            &#123;<br>                bSector = SECTOR_1;<br>                Ta = (Ts &gt;&gt; <span class="hljs-number">1</span>) + ((-wZ + wX) &gt;&gt; <span class="hljs-number">1</span>);<br>                Tb = Ta + wZ;<br>                Tc = Tb - wX;<br>                wTimePhA = Ta &gt;&gt; <span class="hljs-number">1</span>;<br>                wTimePhB = Tb &gt;&gt; <span class="hljs-number">1</span>;<br>                wTimePhC = Tc &gt;&gt; <span class="hljs-number">1</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">/* Load compare registers values */</span><br>    __HAL_TIM_SET_COMPARE(&amp;htim1, TIM_CHANNEL_1, wTimePhA);<br>    __HAL_TIM_SET_COMPARE(&amp;htim1, TIM_CHANNEL_2, wTimePhB);<br>    __HAL_TIM_SET_COMPARE(&amp;htim1, TIM_CHANNEL_3, wTimePhC);<br><br>    __HAL_TIM_SET_COMPARE(&amp;htim1, TIM_CHANNEL_4, <span class="hljs-number">5</span>); <span class="hljs-comment">// trigger next sampel point</span><br>&#125;<br></code></pre></td></tr></table></figure><ol start="2" type="1"><li>计算矢量切换点，定时器配置中，在中心对齐模式下对应于PWM mode2，矢量切换点之前为无效电平，切换点之后为有效电平。 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> SQRT_3 1.732051</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> Ts (PWM_PERIOD * 2)</span><br><br><span class="hljs-type">uint8_t</span> bSector;<br><span class="hljs-type">int32_t</span> wX, wY, wZ, wUAlpha, wUBeta;<br><span class="hljs-type">int32_t</span> wTimePhA = <span class="hljs-number">0</span>, wTimePhB = <span class="hljs-number">0</span>, wTimePhC = <span class="hljs-number">0</span>;<br><span class="hljs-type">int32_t</span> Tp1, Tp2, Tp3;<br><span class="hljs-type">int32_t</span> T1, T2, T3, T4, T5, T6;<br><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span></span><br><span class="hljs-class">&#123;</span><br>    <span class="hljs-type">int16_t</span> alpha;<br>    <span class="hljs-type">int16_t</span> beta;<br>&#125; <span class="hljs-type">alphabeta_t</span>;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">SVPWM</span><span class="hljs-params">(<span class="hljs-type">alphabeta_t</span> Stat_Volt_Input)</span><br>&#123;<br><br>    wUAlpha = (<span class="hljs-type">int32_t</span>)(SQRT_3 * Ts * Stat_Volt_Input.alpha * SQRT_3) &gt;&gt; <span class="hljs-number">15</span>;<br>    wUBeta = (<span class="hljs-type">int32_t</span>)(Ts * Stat_Volt_Input.beta * SQRT_3) &gt;&gt; <span class="hljs-number">15</span>;<br><br>    wX = wUBeta;<br>    wY = (wUBeta + wUAlpha) &gt;&gt; <span class="hljs-number">1</span>;<br>    wZ = (wUBeta - wUAlpha) &gt;&gt; <span class="hljs-number">1</span>;<br><br>    <span class="hljs-comment">// Calculate the vector action time</span><br>    <span class="hljs-keyword">if</span> (wY &lt; <span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (wZ &lt; <span class="hljs-number">0</span>)<br>        &#123;<br>            bSector = SECTOR_5;<br>            T5 = -Y;<br>            T6 = -Z;<br>            Tp1 = (Ts - T5 - T6) &gt;&gt; <span class="hljs-number">2</span>;<br>            Tp2 = Tp1 + (T5 &gt;&gt; <span class="hljs-number">1</span>);<br>            Tp3 = Tp2 + (T6 &gt;&gt; <span class="hljs-number">1</span>);<br>            wTimePhA = Tp2;<br>            wTimePhB = Tp3;<br>            wTimePhC = Tp1;<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-comment">// wZ &gt;= 0</span><br>        &#123;<br>            <span class="hljs-keyword">if</span> (wX &lt;= <span class="hljs-number">0</span>)<br>            &#123;<br>                bSector = SECTOR_4;<br>                T4 = Z;<br>                T5 = -X;<br>                Tp1 = (Ts - T4 - T5) &gt;&gt; <span class="hljs-number">2</span>;<br>                Tp2 = Tp1 + (T4 &gt;&gt; <span class="hljs-number">1</span>);<br>                Tp3 = Tp2 + (T5 &gt;&gt; <span class="hljs-number">1</span>);<br>                wTimePhA = Tp3;<br>                wTimePhB = Tp2;<br>                wTimePhC = Tp1;<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-comment">// wX &gt; 0</span><br>            &#123;<br>                bSector = SECTOR_3;<br>                T3 = X;<br>                T4 = -Y;<br>                Tp1 = (Ts - T3 - T4) &gt;&gt; <span class="hljs-number">2</span>;<br>                Tp2 = Tp1 + (T3 &gt;&gt; <span class="hljs-number">1</span>);<br>                Tp3 = Tp2 + (T4 &gt;&gt; <span class="hljs-number">1</span>);<br>                wTimePhA = Tp3;<br>                wTimePhB = Tp1;<br>                wTimePhC = Tp2;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-comment">// wY &gt; 0</span><br>    &#123;<br>        <span class="hljs-keyword">if</span> (wZ &gt;= <span class="hljs-number">0</span>)<br>        &#123;<br>            bSector = SECTOR_2;<br>            T2 = Y;<br>            T3 = Z;<br>            Tp1 = (Ts - T2 - T3) &gt;&gt; <span class="hljs-number">2</span>;<br>            Tp2 = Tp1 + (T2 &gt;&gt; <span class="hljs-number">1</span>);<br>            Tp3 = Tp2 + (T3 &gt;&gt; <span class="hljs-number">1</span>);<br>            wTimePhA = Tp2;<br>            wTimePhB = Tp1;<br>            wTimePhC = Tp3;<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-comment">// wZ &lt; 0</span><br>        &#123;<br>            <span class="hljs-keyword">if</span> (wX &lt;= <span class="hljs-number">0</span>)<br>            &#123;<br>                bSector = SECTOR_6;<br>                T1 = Y;<br>                T6 = -X;<br>                Tp1 = (Ts - T1 - T6) &gt;&gt; <span class="hljs-number">2</span>;<br>                Tp2 = Tp1 + (T1 &gt;&gt; <span class="hljs-number">1</span>);<br>                Tp3 = Tp2 + (T6 &gt;&gt; <span class="hljs-number">1</span>);<br>                wTimePhA = Tp1;<br>                wTimePhB = Tp3;<br>                wTimePhC = Tp2;<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-comment">// wX &gt; 0</span><br>            &#123;<br>                bSector = SECTOR_1;<br>                T1 = -Z;<br>                T2 = X;<br>                Tp1 = (Ts - T1 - T2) &gt;&gt; <span class="hljs-number">2</span>;<br>                Tp2 = Tp1 + (T1 &gt;&gt; <span class="hljs-number">1</span>);<br>                Tp3 = Tp2 + (T2 &gt;&gt; <span class="hljs-number">1</span>);<br>                wTimePhA = Tp1;<br>                wTimePhB = Tp2;<br>                wTimePhC = Tp3;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">/* Load compare registers values */</span><br>    __HAL_TIM_SET_COMPARE(&amp;htim1, TIM_CHANNEL_1, PWM_PERIOD - wTimePhA);<br>    __HAL_TIM_SET_COMPARE(&amp;htim1, TIM_CHANNEL_2, PWM_PERIOD - wTimePhB);<br>    __HAL_TIM_SET_COMPARE(&amp;htim1, TIM_CHANNEL_3, PWM_PERIOD - wTimePhC);<br><br>    __HAL_TIM_SET_COMPARE(&amp;htim1, TIM_CHANNEL_4, PWM_PERIOD - <span class="hljs-number">5</span>); <span class="hljs-comment">// trigger next sampel point</span><br>&#125;<br></code></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <categories>
      
      <category>SVPWM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>svpwm占空比调制</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
